{% extends "base.html" %}

{% block title %}Attest AI - Understanding Attestation{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-10 mx-auto">
        <!-- Header -->
        <div class="text-center mb-4">
            <h1><i class="fas fa-certificate"></i> Understanding Attestation</h1>
            <p class="lead">Learn how TEE attestation protects your secure computing environment</p>
            <div class="mt-3">
                <a href="/" class="btn btn-primary">
                    <i class="fas fa-arrow-left"></i> Back to Chat
                </a>
            </div>
        </div>

        <!-- Attestation Overview -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> What is Attestation?</h5>
            </div>
            <div class="card-body">
                <p class="lead">Attestation is cryptographic proof that a system is running exactly the code it claims to be running, without any tampering or modifications. Unlike traditional security that asks you to trust promises, attestation provides mathematical evidence that anyone can independently verify.</p>
                
                <div class="row mt-4">
                <div class="col-md-6">
                <h6><i class="fas fa-lock"></i> What Attestation Proves</h6>
                <ul class="list-unstyled">
                <li><strong>Verification:</strong> Cryptographically prove your system hasn't been tampered with</li>
                <li><strong>Confidentiality:</strong> Hardware-enforced data protection with mathematical guarantees</li>
                <li><strong>Integrity:</strong> Verify the system runs only legitimate, unmodified code</li>
                <li><strong>Transparency:</strong> Independently verify security claims without relying on trust</li>
                <li><strong>Auditability:</strong> Complete cryptographic record of system state and changes</li>
                </ul>
                </div>
                <div class="col-md-6">
                <h6><i class="fas fa-microchip"></i> How Attestation Works</h6>
                <ul class="list-unstyled">
                <li><strong>Hardware Foundation:</strong> Silicon-level security that can't be bypassed by software</li>
                <li><strong>Cryptographic Proof:</strong> Mathematical signatures that definitively prove code authenticity</li>
                <li><strong>Remote Verification:</strong> Anyone can independently verify your system's security state</li>
                <li><strong>Isolated Execution:</strong> Code runs in hardware-protected enclaves, physically isolated from all other software</li>
                </ul>
                </div>
                </div>
            </div>
        </div>

        <!-- Dual VM Architecture -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-server"></i> Dual VM Architecture</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-success">
                    <i class="fas fa-check-circle"></i>
                    <strong>Double Layer of Trust:</strong> Attest AI uses two independent VMs - one for the interface and one for AI processing. Both are verified separately, creating enhanced security.
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="attestation-box" id="self-vm-box">
                            <h6><i class="fas fa-shield-alt"></i> Attest AI VM</h6>
                            <p class="small text-muted">Handles user interface and proof generation</p>
                            <div class="status-indicator">
                                <span class="status-circle status-unknown" id="self-vm-status"></span>
                                <span id="self-vm-text">Not Verified</span>
                            </div>
                            <button class="btn btn-outline-primary btn-sm mt-2" id="verify-self-vm">
                                <i class="fas fa-sync"></i> Verify Now
                            </button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="attestation-box" id="secretai-vm-box">
                            <h6><i class="fas fa-brain"></i> Secret AI VM</h6>
                            <p class="small text-muted">Processes AI requests securely</p>
                            <div class="status-indicator">
                                <span class="status-circle status-unknown" id="secretai-vm-status"></span>
                                <span id="secretai-vm-text">Not Verified</span>
                            </div>
                            <button class="btn btn-outline-primary btn-sm mt-2" id="verify-secretai-vm">
                                <i class="fas fa-sync"></i> Verify Now
                            </button>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <button class="btn btn-primary" id="verify-both-vms">
                        <i class="fas fa-shield-alt"></i> Verify Both VMs
                    </button>
                </div>
            </div>
        </div>

        <!-- Attestation Details -->
        <div class="row">
            <!-- Self VM Attestation -->
            <div class="col-lg-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h6><i class="fas fa-shield-alt"></i> Attest AI VM Details</h6>
                    </div>
                    <div class="card-body">
                        <div id="self-vm-details" class="attestation-details" style="display: none;">
                            <div class="mb-3 border-bottom pb-2">
                                <h6 class="text-primary mb-2">Deployment Info</h6>
                                <div class="mb-2">
                                    <strong>Docker Image:</strong>
                                    <code class="d-block small" id="self-docker-image">-</code>
                                </div>
                                <div class="mb-2">
                                    <strong>Build Time:</strong>
                                    <span class="small" id="self-build-time">-</span>
                                </div>
                                <div class="mb-2">
                                    <strong>Image SHA256:</strong>
                                    <code class="d-block small" id="self-image-sha">-</code>
                                </div>
                            </div>
                            <div class="mb-2">
                                <strong>MRTD:</strong>
                                <code class="d-block" id="self-mrtd">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>RTMR0:</strong>
                                <code class="d-block" id="self-rtmr0">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>RTMR1:</strong>
                                <code class="d-block" id="self-rtmr1">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>RTMR2:</strong>
                                <code class="d-block" id="self-rtmr2">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>RTMR3:</strong>
                                <code class="d-block" id="self-rtmr3">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>Report Data:</strong>
                                <code class="d-block small" id="self-report-data">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>Certificate Fingerprint:</strong>
                                <code class="d-block small" id="self-cert-fingerprint">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>Timestamp:</strong>
                                <span id="self-timestamp">-</span>
                            </div>
                        </div>
                        <div id="self-vm-loading" class="text-center" style="display: none;">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <span class="ms-2">Loading attestation...</span>
                        </div>
                        <div id="self-vm-error" class="text-danger" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- Secret AI VM Attestation -->
            <div class="col-lg-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h6><i class="fas fa-brain"></i> Secret AI VM Details</h6>
                    </div>
                    <div class="card-body">
                        <div id="secretai-vm-details" class="attestation-details" style="display: none;">
                            <div class="mb-3 border-bottom pb-2">
                                <h6 class="text-primary mb-2">Deployment Info</h6>
                                <div class="mb-2">
                                    <strong>Docker Image:</strong>
                                    <code class="d-block small" id="secretai-docker-image">-</code>
                                </div>
                                <div class="mb-2">
                                    <strong>Build Time:</strong>
                                    <span class="small" id="secretai-build-time">-</span>
                                </div>
                                <div class="mb-2">
                                    <strong>Image SHA256:</strong>
                                    <code class="d-block small" id="secretai-image-sha">-</code>
                                </div>
                            </div>
                            <div class="mb-2">
                                <strong>MRTD:</strong>
                                <code class="d-block" id="secretai-mrtd">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>RTMR0:</strong>
                                <code class="d-block" id="secretai-rtmr0">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>RTMR1:</strong>
                                <code class="d-block" id="secretai-rtmr1">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>RTMR2:</strong>
                                <code class="d-block" id="secretai-rtmr2">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>RTMR3:</strong>
                                <code class="d-block" id="secretai-rtmr3">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>Report Data:</strong>
                                <code class="d-block small" id="secretai-report-data">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>Certificate Fingerprint:</strong>
                                <code class="d-block small" id="secretai-cert-fingerprint">-</code>
                            </div>
                            <div class="mb-2">
                                <strong>Timestamp:</strong>
                                <span id="secretai-timestamp">-</span>
                            </div>
                        </div>
                        <div id="secretai-vm-loading" class="text-center" style="display: none;">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <span class="ms-2">Loading attestation...</span>
                        </div>
                        <div id="secretai-vm-error" class="text-danger" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- How Attestation Hashes Are Created -->
        <div class="card mb-4" id="hash-generation-section">
            <div class="card-header">
                <h5><i class="fas fa-calculator"></i> How Attestation Hashes Are Created</h5>
            </div>
            <div class="card-body">
                <!-- Compact Explainer -->
                <div id="hash-explainer-compact">
                    <p class="lead">Attestation hashes are cryptographic fingerprints created at each stage of your VM's lifecycle - from hardware boot to runtime monitoring.</p>
                    
                    <div class="row mb-3">
                    <div class="col-md-6">
                    <h6><i class="fas fa-microchip"></i> Boot-Time Creation</h6>
                    <p class="mb-2">SecretVM measures each component in a chain of trust:</p>
                    <ul class="list-unstyled">
                    <li><i class="fas fa-arrow-right text-primary"></i> SEAM Module → Firmware → Initramfs → RootFS</li>
                    <li><i class="fas fa-arrow-right text-primary"></i> Each step measures the next before handing control</li>
                    </ul>
                    </div>
                    <div class="col-md-6">
                    <h6><i class="fas fa-heartbeat"></i> Runtime Updates</h6>
                    <p class="mb-2">System continuously updates measurement values:</p>
                    <ul class="list-unstyled">
                    <li><i class="fas fa-arrow-right text-success"></i> MRTD: Fixed at boot by SEAM Module</li>
                    <li><i class="fas fa-arrow-right text-success"></i> RTMR: Updated at each stage of the boot process</li>
                    </ul>
                    </div>
                    </div>

                    <div class="text-center">
                        <button class="btn btn-primary" onclick="expandHashTimeline()">
                            <i class="fas fa-plus-circle"></i> Show Detailed Timeline Process
                        </button>
                        <small class="d-block mt-2 text-muted">See the step-by-step hash generation process with technical details</small>
                    </div>
                </div>

                <!-- Expanded Timeline Section (Hidden by Default) -->
                <div id="hash-timeline-expanded" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <h6 class="mb-1">Step-by-Step Hash Generation Process</h6>
                            <small class="text-muted">Click any step to see technical implementation details</small>
                        </div>
                        <div>
                            <button class="btn btn-outline-secondary btn-sm" onclick="collapseHashTimeline()">
                                <i class="fas fa-times"></i> Close
                            </button>
                        </div>
                    </div>

                    <!-- Vertical Timeline -->
                    <div class="vertical-timeline">
                        <!-- Step 1: SEAM Module -->
                        <div class="timeline-item" onclick="toggleVerticalDetails(1)">
                            <div class="vertical-step-node step-1">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-title">
                                    <i class="fas fa-shield-alt"></i>
                                    SEAM Module & MRTD Creation
                                </div>
                                <div class="timeline-description">
                                    The Secure Arbitration Mode (SEAM) module measures the firmware into the MRTD register and establishes the root of trust for SecretVM.
                                </div>
                                <div class="hash-info" id="v-details-1" style="display: none;">
                                    <div class="hash-algorithm">Process: Hardware-validated firmware measurement</div>
                                    <div class="hash-output">MRTD = SHA384(firmware_binary + configuration)</div>
                                    <div style="margin-top: 0.5rem;"><strong>Measured Components:</strong></div>
                                    <ul style="margin: 0.25rem 0 0 1rem; font-size: 0.8rem;">
                                        <li>TEE firmware binary and version</li>
                                        <li>Hardware security configuration</li>
                                        <li>Cryptographic keys and certificates</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Firmware Measurements -->
                        <div class="timeline-item" onclick="toggleVerticalDetails(2)">
                            <div class="vertical-step-node step-2">
                                <i class="fas fa-cog"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-title">
                                    <i class="fas fa-cog"></i>
                                    Firmware System Configuration (RTMR0)
                                </div>
                                <div class="timeline-description">
                                    Firmware measures key system configurations into RTMR0, including Configuration Firmware Volume, Trusted Domain Hand-Off Blocks, and ACPI tables.
                                </div>
                                <div class="hash-info" id="v-details-2" style="display: none;">
                                    <div class="hash-algorithm">Algorithm: SHA-384 extending into RTMR0</div>
                                    <div class="hash-output">RTMR0 = SHA384(CFV + TDHOB + ACPI_tables + other_configs)</div>
                                    <div style="margin-top: 0.5rem;"><strong>Measured Components:</strong></div>
                                    <ul style="margin: 0.25rem 0 0 1rem; font-size: 0.8rem;">
                                        <li>Configuration Firmware Volume (CFV)</li>
                                        <li>Trusted Domain Hand-Off Blocks (TDHOB)</li>
                                        <li>ACPI tables and system configuration</li>
                                        <li>Hardware feature configurations</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Kernel Measurement -->
                        <div class="timeline-item" onclick="toggleVerticalDetails(3)">
                            <div class="vertical-step-node step-3">
                                <i class="fas fa-desktop"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-title">
                                    <i class="fas fa-desktop"></i>
                                    OS Kernel Measurement (RTMR1)
                                </div>
                                <div class="timeline-description">
                                    Firmware measures the Linux kernel binary into RTMR1, ensuring the operating system hasn't been tampered with before execution.
                                </div>
                                <div class="hash-info" id="v-details-3" style="display: none;">
                                    <div class="hash-algorithm">Algorithm: SHA-384 extending into RTMR1</div>
                                    <div class="hash-output">RTMR1 = SHA384(kernel_binary + kernel_modules)</div>
                                    <div style="margin-top: 0.5rem;"><strong>Measured Components:</strong></div>
                                    <ul style="margin: 0.25rem 0 0 1rem; font-size: 0.8rem;">
                                        <li>Linux kernel binary (vmlinuz)</li>
                                        <li>Essential kernel modules</li>
                                        <li>Kernel security policies</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Step 4: Initramfs Measurement -->
                        <div class="timeline-item" onclick="toggleVerticalDetails(4)">
                            <div class="vertical-step-node step-4">
                                <i class="fas fa-layer-group"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-title">
                                    <i class="fas fa-layer-group"></i>
                                    Initramfs & Boot Parameters (RTMR2)
                                </div>
                                <div class="timeline-description">
                                    Firmware measures the initramfs (Initial RAM Filesystem) and kernel command line into RTMR2, then transfers control to initramfs.
                                </div>
                                <div class="hash-info" id="v-details-4" style="display: none;">
                                    <div class="hash-algorithm">Algorithm: SHA-384 extending into RTMR2</div>
                                    <div class="hash-output">RTMR2 = SHA384(initramfs_image + kernel_cmdline + boot_params)</div>
                                    <div style="margin-top: 0.5rem;"><strong>Measured Components:</strong></div>
                                    <ul style="margin: 0.25rem 0 0 1rem; font-size: 0.8rem;">
                                        <li>Initial RAM Filesystem (initramfs)</li>
                                        <li>Kernel command line parameters</li>
                                        <li>Boot configuration files</li>
                                        <li>Early boot scripts and utilities</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Step 5: Root Filesystem -->
                        <div class="timeline-item" onclick="toggleVerticalDetails(5)">
                            <div class="vertical-step-node step-5">
                                <i class="fas fa-hdd"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-title">
                                    <i class="fas fa-hdd"></i>
                                    Root Filesystem & Workload (RTMR3)
                                </div>
                                <div class="timeline-description">
                                    Initramfs runs initialization scripts that measure the Root Filesystem and docker-compose.yaml into RTMR3, then launches the containerized workload.
                                </div>
                                <div class="hash-info" id="v-details-5" style="display: none;">
                                    <div class="hash-algorithm">Algorithm: SHA-384 extending into RTMR3</div>
                                    <div class="hash-output">RTMR3 = SHA384(rootfs_hash + docker_compose + container_images)</div>
                                    <div style="margin-top: 0.5rem;"><strong>Measured Components:</strong></div>
                                    <ul style="margin: 0.25rem 0 0 1rem; font-size: 0.8rem;">
                                        <li>Root File System (RootFS) contents</li>
                                        <li>docker-compose.yaml configuration</li>
                                        <li>Container images and dependencies</li>
                                        <li>Application startup scripts</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Step 6: Service Startup -->
                        <div class="timeline-item" onclick="toggleVerticalDetails(6)">
                            <div class="vertical-step-node step-6">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-title">
                                    <i class="fas fa-rocket"></i>
                                    Service Startup & Report Data
                                </div>
                                <div class="timeline-description">
                                    Root filesystem launches SecretVM services, generates TLS certificates, produces GPU attestation (if available), and stores identifiers in the reportdata field.
                                </div>
                                <div class="hash-info" id="v-details-6" style="display: none;">
                                    <div class="hash-algorithm">Process: Service initialization and identity binding</div>
                                    <div class="hash-output">reportdata = TLS_cert_fingerprint + GPU_nonce (if GPU present)</div>
                                    <div style="margin-top: 0.5rem;"><strong>Generated Components:</strong></div>
                                    <ul style="margin: 0.25rem 0 0 1rem; font-size: 0.8rem;">
                                        <li>TLS certificate for secure communications</li>
                                        <li>GPU attestation quote (GPU-enabled VMs)</li>
                                        <li>Attestation service startup</li>
                                        <li>Application containers (AttestAI, SecretAI)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Technical Details -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-cogs"></i> Technical Components Explained</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-fingerprint"></i> Measurement Values</h6>
                        <div class="list-group list-group-flush">
                            <div class="list-group-item">
                                <strong>MRTD</strong> <span class="badge bg-primary">Measurement of Trust Domain</span>
                                <p class="small mt-1 mb-0">Cryptographic hash of the TEE firmware running in the secure environment</p>
                            </div>
                            <div class="list-group-item">
                                <strong>RTMR0</strong> <span class="badge bg-info">System Configuration</span>
                                <p class="small mt-1 mb-0">Measures Configuration Firmware Volume (CFV), Trusted Domain Hand-Off Blocks (TDHOB), and ACPI tables</p>
                            </div>
                            <div class="list-group-item">
                                <strong>RTMR1</strong> <span class="badge bg-info">OS Kernel</span>
                                <p class="small mt-1 mb-0">Contains the cryptographic measurement (hash) of the Linux kernel binary used by SecretVM</p>
                            </div>
                            <div class="list-group-item">
                                <strong>RTMR2</strong> <span class="badge bg-info">Initramfs & Boot Parameters</span>
                                <p class="small mt-1 mb-0">Measures the Initial RAM Filesystem (initramfs) and kernel command line parameters</p>
                            </div>
                            <div class="list-group-item">
                                <strong>RTMR3</strong> <span class="badge bg-info">Root Filesystem & Workload</span>
                                <p class="small mt-1 mb-0">Measures the root filesystem contents and docker-compose.yaml defining the container workload</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-shield-alt"></i> Security Features</h6>
                        <div class="list-group list-group-flush">
                            <div class="list-group-item">
                                <strong>reportdata</strong> <span class="badge bg-success">Instance Identity</span>
                                <p class="small mt-1 mb-0">Contains TLS certificate fingerprint and GPU attestation nonce (if GPU present) to bind VM identity to attestation</p>
                            </div>
                            <div class="list-group-item">
                                <strong>Certificate Fingerprint</strong> <span class="badge bg-warning">MITM Protection</span>
                                <p class="small mt-1 mb-0">Ensures you're talking to the right VM, preventing impersonation attacks</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progressive Disclosure Documentation -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-graduation-cap"></i> Understanding Your Attestation</h5>
            </div>
            <div class="card-body">
                <p class="mb-4">Click each level to learn more about how your secure environment is protected:</p>
                
                <!-- Boot Integrity & Chain of Trust -->
                <div class="drill-down-container">
                    <h6><i class="fas fa-shield-alt"></i> Boot Integrity & Chain of Trust</h6>
                    
                    <div class="drill-down-level" data-level="1" data-topic="boot">
                        <div class="level-header">
                            <div class="d-flex align-items-center">
                                <div class="level-icon level-1">1</div>
                                <span>Secure boot verified ✓</span>
                            </div>
                            <i class="fas fa-chevron-right expand-icon"></i>
                        </div>
                        <div class="level-content">
                            Your virtual machine's boot process has been cryptographically verified from hardware to applications.
                        </div>
                    </div>
                    
                    <div class="drill-down-level locked" data-level="2" data-topic="boot">
                        <div class="level-header">
                            <div class="d-flex align-items-center">
                                <div class="level-icon level-2">2</div>
                                <span>Like a construction inspection process - each stage gets certified before moving to the next</span>
                            </div>
                            <i class="fas fa-chevron-right expand-icon"></i>
                        </div>
                        <div class="level-content">
                            <div class="analogy-highlight">
                                <i class="fas fa-hard-hat"></i> <strong>Think of it like:</strong> Building a house with mandatory inspections at each stage. Just as a house needs foundation inspection, framing inspection, electrical inspection, and final walkthrough - each signed off by certified inspectors - your VM goes through mandatory security inspections at each boot stage.
                            </div>
                            <p>The SEAM Module acts like the head building inspector, creating a permanent record (MRTD) that the foundation is solid. Then each construction phase gets its own inspection certificate (RTMR0-3) before moving to the next stage. If anything is wrong at any stage, the whole process stops.</p>
                        </div>
                    </div>
                    
                    <div class="drill-down-level locked" data-level="3" data-topic="boot">
                        <div class="level-header">
                            <div class="d-flex align-items-center">
                                <div class="level-icon level-3">3</div>
                                <span>MRTD and RTMR measurements verify each boot stage</span>
                            </div>
                            <i class="fas fa-chevron-right expand-icon"></i>
                        </div>
                        <div class="level-content">
                            <p><strong>Technical Details:</strong> Boot integrity verification involves:</p>
                            <ul>
                                <li><strong>MRTD:</strong> Created once by SEAM Module - immutable measurement of firmware</li>
                                <li><strong>RTMR0:</strong> System Configuration (CFV, TDHOB, ACPI tables)</li>
                                <li><strong>RTMR1:</strong> OS Kernel (Linux kernel binary)</li>
                                <li><strong>RTMR2:</strong> Initramfs & Boot Parameters (initramfs + kernel command line)</li>
                                <li><strong>RTMR3:</strong> Root Filesystem & Workload (RootFS + docker-compose.yaml)</li>
                            </ul>
                            <div class="technical-data" id="current-boot">
                                Click "Verify" above to see the actual MRTD and RTMR values
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Identity & Communication Security -->
                <div class="drill-down-container">
                    <h6><i class="fas fa-id-card"></i> Identity & Communication Security</h6>
                    
                    <div class="drill-down-level" data-level="1" data-topic="identity">
                        <div class="level-header">
                            <div class="d-flex align-items-center">
                                <div class="level-icon level-1">1</div>
                                <span>Secure communication verified ✓</span>
                            </div>
                            <i class="fas fa-chevron-right expand-icon"></i>
                        </div>
                        <div class="level-content">
                            Your connection is protected against impersonation and man-in-the-middle attacks.
                        </div>
                    </div>
                    
                    <div class="drill-down-level locked" data-level="2" data-topic="identity">
                        <div class="level-header">
                            <div class="d-flex align-items-center">
                                <div class="level-icon level-2">2</div>
                                <span>Like a package tracking system - unique ID binds this specific VM to your communication</span>
                            </div>
                            <i class="fas fa-chevron-right expand-icon"></i>
                        </div>
                        <div class="level-content">
                            <div class="analogy-highlight">
                                <i class="fas fa-shipping-fast"></i> <strong>Think of it like:</strong> A secure package delivery system where each package has a unique tracking number that binds the specific package to the specific recipient. No one can forge the tracking number or redirect your package to themselves.
                            </div>
                            <p>The VM creates a unique cryptographic binding between this specific VM instance and your communication channel. This prevents attackers from impersonating the VM or replaying old responses from a different session. The binding includes both the communication certificate and instance-specific identifiers that change with each deployment.</p>
                        </div>
                    </div>
                    
                    <div class="drill-down-level locked" data-level="3" data-topic="identity">
                        <div class="level-header">
                            <div class="d-flex align-items-center">
                                <div class="level-icon level-3">3</div>
                                <span>Certificate fingerprint and report data provide cryptographic binding</span>
                            </div>
                            <i class="fas fa-chevron-right expand-icon"></i>
                        </div>
                        <div class="level-content">
                            <p><strong>Technical Details:</strong></p>
                            <ul>
                                <li><strong>Certificate Fingerprint:</strong> SHA-256 hash of TLS certificate prevents MITM attacks by ensuring you're communicating with the correct VM endpoint</li>
                                <li><strong>Report Data:</strong> 64-byte field containing TLS certificate fingerprint concatenated with GPU attestation nonce (if GPU present). This cryptographically binds the VM's identity to the attestation, preventing certificate substitution attacks and ensuring the attested VM is the same one handling your requests. The GPU nonce provides additional entropy for GPU-enabled VMs.</li>
                            </ul>
                            <div class="technical-data" id="current-identity">
                                Click "Verify" above to see the actual Certificate Fingerprint and Report Data
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Infrastructure Transparency -->
                <div class="drill-down-container">
                    <h6><i class="fas fa-code-branch"></i> Infrastructure Transparency</h6>
                    
                    <div class="drill-down-level" data-level="1" data-topic="infra">
                        <div class="level-header">
                            <div class="d-flex align-items-center">
                                <div class="level-icon level-1">1</div>
                                <span>Running verified code ✓</span>
                            </div>
                            <i class="fas fa-chevron-right expand-icon"></i>
                        </div>
                        <div class="level-content">
                            The system is running verified, unmodified code from trusted sources.
                        </div>
                    </div>
                    
                    <div class="drill-down-level locked" data-level="2" data-topic="infra">
                        <div class="level-header">
                            <div class="d-flex align-items-center">
                                <div class="level-icon level-2">2</div>
                                <span>Like checking the software version and publisher before installing</span>
                            </div>
                            <i class="fas fa-chevron-right expand-icon"></i>
                        </div>
                        <div class="level-content">
                            <div class="analogy-highlight">
                                <i class="fas fa-download"></i> <strong>Think of it like:</strong> Downloading an app from an official app store - you can verify the publisher, version, and that it hasn't been modified since the developer signed it.
                            </div>
                            <p>Just as you can check an app's developer, version number, and download source, you can verify exactly which Docker images are running, when they were built, and trace them back to the original GitHub repository. This prevents supply chain attacks where malicious code gets substituted.</p>
                        </div>
                    </div>
                    
                    <div class="drill-down-level locked" data-level="3" data-topic="infra">
                        <div class="level-header">
                            <div class="d-flex align-items-center">
                                <div class="level-icon level-3">3</div>
                                <span>Docker image and GitHub commit verification available</span>
                            </div>
                            <i class="fas fa-chevron-right expand-icon"></i>
                        </div>
                        <div class="level-content">
                            <p><strong>Technical Details:</strong></p>
                            <ul>
                                <li><strong>Current Deployment:</strong> Docker image details verified through TEE attestation system</li>
                                <li><strong>Source Code:</strong> MrGarbonzo/secretGPT - open source project</li>
                                <li><strong>Build Verification:</strong> Image SHA256, build timestamps, and compose file hashes provide complete deployment transparency</li>
                                <li><strong>Supply Chain:</strong> Traceable from GitHub commit → Docker build → VM deployment</li>
                            </ul>
                            <div class="technical-data" id="deployment-info">
                                <span class="text-muted">
                                    <i class="fas fa-shield-alt"></i> Deployment verification requires TEE attestation<br>
                                    <small>Image details available through VM attestation system</small>
                                </span>
                            </div>
                            <p class="mt-2">
                                <a href="https://github.com/MrGarbonzo/secretGPT" target="_blank" class="btn btn-outline-primary btn-sm">
                                    <i class="fab fa-github"></i> View Source Code
                                </a>
                                <a href="https://github.com/MrGarbonzo/secretGPT/pkgs/container/secretgpt" target="_blank" class="btn btn-outline-secondary btn-sm ms-2">
                                    <i class="fab fa-docker"></i> View GHCR Image
                                </a>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Hardware Foundation -->
                <div class="drill-down-container">
                    <h6><i class="fas fa-microchip"></i> Hardware Foundation</h6>
                    
                    <div class="drill-down-level" data-level="1" data-topic="hardware">
                        <div class="level-header">
                            <div class="d-flex align-items-center">
                                <div class="level-icon level-1">1</div>
                                <span>Hardware security verified ✓</span>
                            </div>
                            <i class="fas fa-chevron-right expand-icon"></i>
                        </div>
                        <div class="level-content">
                            Silicon-level security that cannot be bypassed by software.
                        </div>
                    </div>
                    
                    <div class="drill-down-level locked" data-level="2" data-topic="hardware">
                        <div class="level-header">
                            <div class="d-flex align-items-center">
                                <div class="level-icon level-2">2</div>
                                <span>Like a bank vault built into the processor</span>
                            </div>
                            <i class="fas fa-chevron-right expand-icon"></i>
                        </div>
                        <div class="level-content">
                            <div class="analogy-highlight">
                                <i class="fas fa-university"></i> <strong>Think of it like:</strong> A bank vault built into the computer's processor - even if someone has complete control of the software, they can't break into the hardware security vault or forge its signatures.
                            </div>
                            <p>Intel TDX creates a secure enclave directly in the CPU hardware that's isolated from all software - even the operating system, hypervisor, or BIOS can't access or modify it. The SEAM Module runs inside this hardware vault and creates cryptographic signatures that prove the measurements are authentic.</p>
                        </div>
                    </div>
                    
                    <div class="drill-down-level locked" data-level="3" data-topic="hardware">
                        <div class="level-header">
                            <div class="d-flex align-items-center">
                                <div class="level-icon level-3">3</div>
                                <span>SEAM Module and hardware attestation chain provide unbreakable foundation</span>
                            </div>
                            <i class="fas fa-chevron-right expand-icon"></i>
                        </div>
                        <div class="level-content">
                            <p><strong>Technical Details:</strong></p>
                            <ul>
                                <li><strong>SEAM Module:</strong> Secure Arbitration Mode - Intel TDX hardware component that measures firmware into MRTD</li>
                                <li><strong>Hardware Isolation:</strong> CPU-level memory encryption and access controls prevent software interference</li>
                                <li><strong>Cryptographic Foundation:</strong> Hardware-rooted attestation keys that cannot be extracted or forged</li>
                                <li><strong>Trust Chain:</strong> Intel Root CA → Platform Certificate → VM Attestation creates unbreakable verification chain</li>
                            </ul>
                            <div class="technical-data" id="current-hardware">
                                Click "Verify" above to see the hardware attestation chain details
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Verifying Your Attestation -->
        <div class="card mb-4" id="verification-generation-section">
            <div class="card-header">
                <h5><i class="fas fa-search"></i> Verifying Your Attestation</h5>
            </div>
            <div class="card-body">
                <p class="lead">Verification proves your attestation measurements are cryptographically authentic and match expected values for a secure system.</p>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6><i class="fas fa-link"></i> Chain of Trust</h6>
                        <p class="mb-2">Cryptographic validation from Intel's manufacturing to your VM:</p>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-arrow-right text-primary"></i> Intel Root CA validates platform certificates during hardware manufacturing</li>
                            <li><i class="fas fa-arrow-right text-primary"></i> Platform certificates authenticate the SEAM Module</li>
                            <li><i class="fas fa-arrow-right text-primary"></i> SEAM Module measures firmware and creates MRTD</li>
                            <li><i class="fas fa-arrow-right text-primary"></i> Your VM's measurements are cryptographically signed by this chain</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-balance-scale"></i> Measurement Validation</h6>
                        <p class="mb-2">Compare actual measurements against known-good baselines:</p>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-arrow-right text-success"></i> <strong>MRTD:</strong> Matches known-good firmware configuration for your VM type</li>
                            <li><i class="fas fa-arrow-right text-success"></i> <strong>RTMRs:</strong> Boot process stages completed with legitimate components (RTMR0: system config, RTMR1: kernel, RTMR2: initramfs, RTMR3: rootfs/workload)</li>
                        </ul>
                    </div>
                </div>

                <!-- What Verification Proves -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h6><i class="fas fa-check-circle"></i> What Verification Proves</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-arrow-right text-success"></i> Measurements are cryptographically authentic and unforged</li>
                            <li><i class="fas fa-arrow-right text-success"></i> System matches known-good configuration baselines</li>
                            <li><i class="fas fa-arrow-right text-success"></i> No tampering occurred during the boot process</li>
                            <li><i class="fas fa-arrow-right text-success"></i> Hardware and software integrity confirmed through SEAM Module</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-exclamation-triangle"></i> What Verification Catches</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-arrow-right text-danger"></i> Malware injection attempts during boot</li>
                            <li><i class="fas fa-arrow-right text-danger"></i> Unauthorized modifications to firmware, kernel, or applications</li>
                            <li><i class="fas fa-arrow-right text-danger"></i> Configuration tampering in any boot stage</li>
                            <li><i class="fas fa-arrow-right text-danger"></i> Replay attacks using old or invalid measurements</li>
                        </ul>
                    </div>
                </div>

                <!-- Certificate Chain of Trust -->
                <h6><i class="fas fa-link"></i> Certificate Chain of Trust</h6>
                <p class="mb-3">Attestation verification follows an unbreakable chain of cryptographic trust:</p>
                
                <div class="cert-chain">
                    <div class="cert-level root">
                        <i class="fas fa-certificate"></i>
                        <div><strong>Intel Root CA</strong></div>
                        <small>Hardware manufacturer</small>
                    </div>
                    <div class="cert-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="cert-level intermediate">
                        <i class="fas fa-microchip"></i>
                        <div><strong>TDX Platform</strong></div>
                        <small>Specific CPU/motherboard</small>
                    </div>
                    <div class="cert-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="cert-level intermediate">
                        <i class="fas fa-shield-alt"></i>
                        <div><strong>SEAM Module</strong></div>
                        <small>Firmware measurement</small>
                    </div>
                    <div class="cert-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="cert-level leaf">
                        <i class="fas fa-server"></i>
                        <div><strong>Your VM</strong></div>
                        <small>Attestation report</small>
                    </div>
                </div>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> <strong>Root of Trust:</strong> 
                    Intel's root certificates are embedded in TDX hardware during manufacturing and cannot be modified. The SEAM Module, running in hardware-isolated mode, creates measurements that trace back to Intel's secure facilities through this cryptographic chain.
                </div>

                <!-- Verification Steps -->
                <h6 class="mt-4"><i class="fas fa-list-ol"></i> Step-by-Step Verification Process</h6>
                
                <div class="verification-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">Certificate Validation</div>
                        <div class="step-description">
                            Verify the attestation report's digital signature using Intel's certificate chain. Like checking a bank's seal on important documents, this proves the measurements came from genuine Intel TDX hardware via the SEAM Module, not a fake or compromised system.
                        </div>
                    </div>
                </div>

                <div class="verification-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">Measurement Comparison</div>
                        <div class="step-description">
                            Compare actual MRTD and RTMR values against known-good "golden" measurements for your specific system configuration. These baselines are provided by SecretVM and represent the expected measurements for legitimate, unmodified deployments. Exact matches prove no unauthorized changes occurred during any boot stage.
                        </div>
                    </div>
                </div>

                <div class="verification-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">Freshness Check</div>
                        <div class="step-description">
                            Verify the attestation timestamp and nonce to prevent replay attacks. Like checking expiration dates on documents, this ensures you're seeing current measurements from the actual running system, not old measurements from a previously compromised system or a replay attack.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Resources -->
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-external-link-alt"></i> Learn More</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-book"></i> Documentation</h6>
                        <ul class="list-unstyled">
                            <li><a href="https://docs.scrt.network/" target="_blank">Secret Network Docs</a></li>
                            <li><a href="https://intel.com/content/www/us/en/developer/tools/trust-domain-extensions/overview.html" target="_blank">Intel TDX Overview</a></li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fab fa-github"></i> Source Code</h6>
                        <ul class="list-unstyled">
                            <li><a href="https://github.com/scrtlabs/secretvm" target="_blank">SecretVM</a></li>
                            <li><a href="https://github.com/MrGarbonzo/secretGPT" target="_blank">secretGPT</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', path='/js/attestation.js') }}"></script>
{% endblock %}
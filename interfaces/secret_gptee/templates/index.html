<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <base href="/secret_gptee/">

    <!-- SecretGPTee Styling -->
    <link rel="stylesheet" href="/secret_gptee/static/css/main.css?v=2025010107">
    <link rel="stylesheet" href="/secret_gptee/static/css/chat.css?v=2025081414">
    <link rel="stylesheet" href="/secret_gptee/static/css/wallet.css?v=2025010107">

    <!-- Inline CSS to fix immediate formatting issues -->
    <style>
        /* Critical styles for immediate fix */
        :root {
            --primary-color: #e8175d;
            --primary-hover: #d1154f;
            --secondary-color: #1a1b23;
            --accent-color: #4ecdc4;
            --bg-primary: #0d0e14;
            --bg-secondary: #1a1b23;
            --bg-tertiary: #2a2d3a;
            --bg-input: #1e1f2e;
            --text-primary: #ffffff;
            --text-secondary: #a0a3b5;
            --text-muted: #6c7086;
            --border-color: #313244;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .app-header {
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: var(--spacing-sm) var(--spacing-lg);
            flex-shrink: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .logo-icon {
            height: 32px;
            width: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-color);
            border-radius: var(--radius-md);
            font-size: 1.25rem;
            color: white;
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }

        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            background-color: var(--bg-primary);
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 80px);
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            padding: var(--spacing-lg);
        }

        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-md);
            scroll-behavior: smooth;
        }

        .input-area {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn.primary:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
        }

        .hidden {
            display: none !important;
        }

        /* Chat message styles */
        .message-wrapper {
            margin-bottom: var(--spacing-md);
            animation: fadeIn 0.3s ease-out;
        }

        .message {
            display: flex;
            gap: var(--spacing-sm);
            max-width: 80%;
        }

        .user-message {
            margin-left: auto;
        }

        .user-message .message {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--accent-color);
            font-size: 1rem;
            flex-shrink: 0;
        }

        .message-content {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--border-color);
            flex: 1;
        }

        .user-message .message-content {
            background: var(--primary-color);
            color: white;
        }

        .message-text {
            word-wrap: break-word;
            line-height: 1.5;
        }

        /* Input area improvements */
        #message-input {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 1rem;
            resize: none;
            min-height: 44px;
            max-height: 120px;
        }

        #message-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .send-btn {
            margin-left: var(--spacing-sm);
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Wallet button improvements */
        .wallet-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .wallet-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--primary-color);
        }
    </style>
    
    <!-- Modern fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Favicon - using data URI for simple icon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>">
    
    <!-- Meta tags for PWA -->
    <meta name="theme-color" content="#1a1b23">
    <meta name="description" content="SecretGPTee - AI Chat with Secret Network Integration">
</head>
<body>
    <!-- Main App Container -->
    <div id="app" class="app-container">
        
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <!-- Logo and Title -->
                <div class="header-left">
                    <div class="logo-icon">⚡</div>
                    <h1 class="app-title">SecretGPTee</h1>
                    <span class="version-badge">v1.0</span>
                </div>
                
                <!-- Header Actions -->
                <div class="header-right">
                    <!-- Keplr Wallet Connection -->
                    <div class="wallet-section">
                        <button id="wallet-connect-btn" class="wallet-btn keplr-btn" onclick="toggleWallet()">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA2TDE3Ljc0IDEzLjA5TDIyIDEyTDE0Ljc0IDEzLjA5TDEyIDIyTDkuMjYgMTMuMDlMMiAxMkw2LjI2IDEzLjA5TDQgNkwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSJjdXJyZW50Q29sb3IiLz4KPC9zdmc+" alt="Keplr" class="keplr-logo">
                            <span id="wallet-status">Connect Keplr</span>
                        </button>
                        <div id="wallet-info" class="wallet-info hidden">
                            <div class="wallet-address" id="wallet-address"></div>
                            <div class="wallet-balance" id="wallet-balance"></div>
                        </div>
                    </div>
                    
                    <!-- Settings Button -->
                    <button class="icon-btn settings-btn" onclick="toggleSettings()" title="Settings">
                        <i class="fas fa-cog"></i>
                    </button>
                    
                    <!-- Theme Toggle -->
                    <button class="icon-btn theme-btn" onclick="toggleTheme()" title="Toggle Theme">
                        <i class="fas fa-moon" id="theme-icon"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Main Content Area -->
        <main class="main-content">
            
            <!-- Wallet Sidebar -->
            <aside id="wallet-sidebar" class="wallet-sidebar hidden">
                <div class="sidebar-header">
                    <h3>Wallet</h3>
                    <button class="close-btn" onclick="toggleWalletSidebar()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="sidebar-content">
                    <!-- Wallet Info Section -->
                    <div class="wallet-info-section">
                        <div class="wallet-address-display">
                            <label>Address</label>
                            <div class="address-box">
                                <span id="sidebar-wallet-address">Not Connected</span>
                                <button class="copy-btn" onclick="copyWalletAddress()" title="Copy Address">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Balance Section -->
                    <div class="balance-section">
                        <div class="balance-header">
                            <h4>Balances</h4>
                            <button class="refresh-btn" onclick="refreshBalance()" title="Refresh Balances">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        
                        <!-- SCRT Balance (Primary) -->
                        <div class="token-balance primary-balance">
                            <div class="token-info">
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiMxYTFiMjMiLz4KPHBhdGggZD0iTTE2IDZMMTcuNTkgMTEuMDRMMjMgOEwyMC4wNCAxMy40MUwyNiAxNkwyMC4wNCAxNC40MUwxNiAyNkwxMS45NiAxNC40MUw2IDE2TDExLjk2IDEzLjQxTDkgOEwxNC40MSAxMS4wNEwxNiA2WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+" alt="SCRT" class="token-icon">
                                <div class="token-details">
                                    <span class="token-symbol">SCRT</span>
                                    <span class="token-name">Secret</span>
                                </div>
                            </div>
                            <div class="token-amount">
                                <span id="scrt-balance" class="balance-value">0.000000</span>
                                <span class="balance-usd">$0.00</span>
                            </div>
                        </div>
                        
                        <!-- Future: Additional Tokens -->
                        <div id="additional-tokens" class="additional-tokens">
                            <!-- Additional token balances will be added here -->
                        </div>
                    </div>
                    
                    <!-- Actions Section -->
                    <div class="wallet-actions">
                        <button class="action-btn" onclick="showSendModal()">
                            <i class="fas fa-paper-plane"></i>
                            Send
                        </button>
                        <button class="action-btn" onclick="showReceiveModal()">
                            <i class="fas fa-qrcode"></i>
                            Receive
                        </button>
                    </div>
                </div>
            </aside>
            
            <!-- Chat Container -->
            <div class="chat-container">
                
                <!-- Messages Area -->
                <div id="messages" class="messages-area">
                    <!-- Welcome Message -->
                    <div class="message assistant-message welcome-message">
                        <div class="message-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-text">
                                <h3>Welcome to SecretGPTee! 🔐</h3>
                                <p>I'm your AI assistant with <strong>Secret Network</strong> integration. I can help you with:</p>
                                <ul>
                                    <li>💬 General questions and conversations</li>
                                    <li>🔗 Secret Network blockchain queries</li>
                                    <li>💰 Wallet balance checks and transactions</li>
                                    <li>📊 Live blockchain data and statistics</li>
                                </ul>
                                <p>Connect your <strong>Keplr wallet</strong> to unlock Secret Network features, or just start chatting!</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Input Area -->
                <div class="input-area">
                    <div class="input-container">
                        <div class="input-wrapper">
                            <textarea 
                                id="message-input" 
                                placeholder="Type your message... (or try 'What's the Secret Network status?')"
                                rows="1"
                                maxlength="4000"></textarea>
                            <div class="input-actions">
                                <button class="icon-btn attach-btn" title="Attach File" disabled>
                                    <i class="fas fa-paperclip"></i>
                                </button>
                                <button id="send-btn" class="send-btn" onclick="sendMessage()" title="Send Message">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Input Footer -->
                        <div class="input-footer">
                            <span class="char-count">0 / 4000</span>
                            <div class="input-options">
                                <span class="temperature-display">Temperature: <span id="temp-value">0.7</span></span>
                                <button class="toggle-btn" onclick="toggleStreaming()" title="Toggle Streaming">
                                    <i class="fas fa-stream" id="streaming-icon"></i>
                                    <span id="streaming-text">Streaming</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </main>
        
        <!-- Settings Panel -->
        <div id="settings-panel" class="settings-panel hidden">
            <div class="settings-content">
                <div class="settings-header">
                    <h3>Settings</h3>
                    <button class="close-btn" onclick="toggleSettings()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="settings-body">
                    
                    <!-- Chat Settings -->
                    <div class="settings-section">
                        <h4>Chat Settings</h4>
                        
                        <div class="setting-item">
                            <label for="temperature-slider">Creativity (Temperature)</label>
                            <div class="slider-container">
                                <input type="range" id="temperature-slider" min="0" max="1" step="0.1" value="0.7">
                                <div class="slider-labels">
                                    <span>Conservative</span>
                                    <span>Balanced</span>
                                    <span>Creative</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="enable-tools" checked>
                                Enable Blockchain Tools
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="enable-streaming" checked>
                                Real-time Streaming
                            </label>
                        </div>
                    </div>
                    
                    <!-- Wallet Settings -->
                    <div class="settings-section">
                        <h4>Wallet Settings</h4>
                        
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="auto-connect-wallet">
                                Auto-connect wallet on visit
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label for="default-gas">Default Gas Limit</label>
                            <input type="number" id="default-gas" value="200000" min="80000" max="2000000">
                        </div>
                    </div>
                    
                    <!-- Privacy Settings -->
                    <div class="settings-section">
                        <h4>Privacy Settings</h4>
                        
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="local-storage-only" checked>
                                Store conversations locally only
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="privacy-mode">
                                Privacy mode (no conversation history)  
                            </label>
                        </div>
                    </div>
                    
                </div>
                
                <div class="settings-footer">
                    <button class="btn secondary" onclick="resetSettings()">Reset to Defaults</button>
                    <button class="btn primary" onclick="saveSettings()">Save Settings</button>
                </div>
            </div>
        </div>
        
        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <span>Connecting to Secret Network...</span>
            </div>
        </div>
        
        <!-- Toast Notifications -->
        <div id="toast-container" class="toast-container"></div>
        
    </div>
    
    <!-- JavaScript -->
    <!-- SecretJS Library (Official UMD Browser Bundle) -->
    <script>
        // Load SecretJS using official browser method with fallbacks
        (function loadSecretJS() {
            let attempts = 0;
            const maxAttempts = 3;
            
            // CDN sources to try in order
            const cdnSources = [
                'https://unpkg.com/secretjs@1.21.2/dist/browser.js',
                'https://cdn.jsdelivr.net/npm/secretjs@1.21.2/dist/browser.js',
                '/static/js/secretjs.browser.js' // Local fallback
            ];
            
            function tryLoadFromCDN(index = 0) {
                if (index >= cdnSources.length) {
                    console.error('❌ All SecretJS CDN sources failed to load');
                    return;
                }
                
                const scriptSrc = cdnSources[index];
                console.log(`📦 Loading SecretJS from: ${scriptSrc}`);
                
                const script = document.createElement('script');
                script.src = scriptSrc;
                
                script.onload = function() {
                    // Check if SecretJS loaded properly
                    if (typeof window.secretjs !== 'undefined' && window.secretjs.SecretNetworkClient) {
                        console.log('✅ SecretJS loaded successfully from:', scriptSrc);
                        
                        // Expose components to global scope for compatibility
                        window.SecretNetworkClient = window.secretjs.SecretNetworkClient;
                        window.MsgSend = window.secretjs.MsgSend;
                        window.calculateFee = window.secretjs.calculateFee;
                        
                        console.log('✅ SecretNetworkClient exposed globally:', window.SecretNetworkClient);
                        
                        // Dispatch event to notify wallet.js
                        window.dispatchEvent(new CustomEvent('secretjs-loaded'));
                    } else {
                        console.warn('⚠️ SecretJS script loaded but secretjs global not found');
                        // Try next CDN
                        tryLoadFromCDN(index + 1);
                    }
                };
                
                script.onerror = function() {
                    console.warn(`❌ Failed to load SecretJS from: ${scriptSrc}`);
                    // Try next CDN
                    tryLoadFromCDN(index + 1);
                };
                
                document.head.appendChild(script);
            }
            
            // Start loading
            tryLoadFromCDN();
        })();
    </script>
    
    <!-- SecretJS Loading Verification -->
    <script>
        // Final verification with timeout
        setTimeout(() => {
            if (typeof SecretNetworkClient !== 'undefined') {
                console.log('✅ Final verification: SecretJS loaded successfully');
                console.log('SecretNetworkClient available:', typeof SecretNetworkClient);
                console.log('window.secretjs available:', typeof window.secretjs);
            } else {
                console.error('❌ Final verification: SecretJS failed to load after all attempts');
                console.log('Available globals containing "secret":', 
                    Object.keys(window).filter(k => k.toLowerCase().includes('secret'))
                );
                
                // Show user-friendly error message
                if (window.SecretGPTee && window.SecretGPTee.showToast) {
                    window.SecretGPTee.showToast('SecretJS library failed to load. Please check your internet connection and refresh the page.', 'error');
                } else {
                    console.warn('SecretGPTee toast system not available yet');
                }
            }
        }, 3000); // Longer timeout to allow for CDN fallbacks
    </script>
    
    <script src="/secret_gptee/static/js/app.js?v=2025010107"></script>
    <script src="/secret_gptee/static/js/chat.js?v=20250923042200"></script>
    <script src="/secret_gptee/static/js/wallet.js?v=20250923042300"></script>
    <script src="/secret_gptee/static/js/debug-wallet.js?v=2025010107"></script>
    <script src="/secret_gptee/static/js/settings.js?v=2025010107"></script>
    
    <!-- Essential Functions -->
    <script>
        // Essential functions for basic functionality

        // Wallet functions
        function toggleWallet() {
            console.log('Wallet toggle clicked');
            if (window.keplr) {
                connectKeplr();
            } else {
                alert('Keplr wallet not found. Please install Keplr extension.');
            }
        }

        async function connectKeplr() {
            try {
                await window.keplr.enable('secret-4');
                const offlineSigner = window.keplr.getOfflineSigner('secret-4');
                const accounts = await offlineSigner.getAccounts();

                if (accounts.length > 0) {
                    const address = accounts[0].address;
                    document.getElementById('wallet-status').textContent =
                        address.slice(0, 10) + '...' + address.slice(-6);
                    document.getElementById('wallet-connect-btn').style.backgroundColor = '#4ecdc4';
                }
            } catch (error) {
                console.error('Failed to connect to Keplr:', error);
                alert('Failed to connect to Keplr wallet');
            }
        }

        function toggleWalletSidebar() {
            const sidebar = document.getElementById('wallet-sidebar');
            sidebar.classList.toggle('hidden');
        }

        // Settings functions
        function toggleSettings() {
            const sidebar = document.getElementById('settings-sidebar');
            sidebar.classList.toggle('hidden');
        }

        function toggleTheme() {
            document.body.classList.toggle('light-theme');
        }

        function toggleStreaming() {
            const btn = event.target;
            btn.classList.toggle('active');
            console.log('Streaming toggled');
        }

        // Chat functions
        function sendMessage() {
            // Use ChatInterface if available, otherwise use inline function
            if (window.ChatInterface && window.ChatInterface.sendMessage) {
                window.ChatInterface.sendMessage();
            } else {
                // Fallback inline implementation
                const textarea = document.getElementById('message-input');
                const message = textarea.value.trim();

                if (!message) return;

                // Add user message to chat
                addMessageToChat('user', message);
                textarea.value = '';

                // Send to API
                sendToAPI(message);
            }
        }

        function addMessageToChat(role, content) {
            const messagesArea = document.getElementById('messages'); // Fixed: was 'messages-area'
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-wrapper ${role}-message`;

            messageDiv.innerHTML = `
                <div class="message">
                    <div class="message-avatar">${role === 'user' ? '👤' : '🤖'}</div>
                    <div class="message-content">
                        <div class="message-text">${content}</div>
                    </div>
                </div>
            `;

            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        async function sendToAPI(message) {
            try {
                const response = await fetch('/secret_gptee/api/v1/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        wallet_address: null
                    })
                });

                const data = await response.json();

                if (data.response) {
                    addMessageToChat('assistant', data.response);
                } else {
                    addMessageToChat('assistant', 'Sorry, I encountered an error. Please try again.');
                }
            } catch (error) {
                console.error('API Error:', error);
                addMessageToChat('assistant', 'Sorry, I encountered a connection error. Please try again.');
            }
        }

        // Utility functions
        function autoResize() {
            const textarea = event.target;
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        function updateCharCount(length) {
            const charCountElement = document.querySelector('.char-count');
            if (charCountElement) {
                charCountElement.textContent = `${length} / 4000`;
            }
        }

        // Stub functions for external JS files
        function initializeApp() { console.log('App initialized'); }
        function initializeChat() { console.log('Chat initialized'); }
        function initializeWallet() { console.log('Wallet initialized'); }
        function initializeSettings() { console.log('Settings initialized'); }
        function loadUserSettings() { console.log('Settings loaded'); }
    </script>

    <!-- Initialize App -->
    <script>
        // Initialize SecretGPTee app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔐 SecretGPTee loaded successfully');
            
            // Initialize components
            initializeApp();
            initializeChat();
            initializeWallet();
            initializeSettings();
            
            // Load user settings
            loadUserSettings();
            
            // Auto-resize textarea
            const textarea = document.getElementById('message-input');
            textarea.addEventListener('input', autoResize);
            
            // Keyboard shortcuts
            textarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Character counter
            textarea.addEventListener('input', updateCharCount);
        });
    </script>
</body>
</html>
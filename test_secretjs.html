<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecretJS Loading Test</title>
</head>
<body>
    <h1>SecretJS Loading Test</h1>
    <div id="status">Loading SecretJS...</div>
    <div id="results"></div>

    <!-- SecretJS Library via dynamic import (more reliable) -->
    <script>
        // Load SecretJS dynamically and expose globals
        (async function loadSecretJS() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            try {
                console.log('üì¶ Loading SecretJS...');
                statusDiv.textContent = 'Loading SecretJS via Skypack...';
                
                // Try dynamic import first
                const secretjs = await import('https://cdn.skypack.dev/secretjs@1.15.1');
                console.log('‚úÖ SecretJS imported successfully via Skypack');
                
                // Expose to global scope
                window.SecretNetworkClient = secretjs.SecretNetworkClient;
                window.MsgSend = secretjs.MsgSend;
                window.calculateFee = secretjs.calculateFee;
                
                console.log('‚úÖ SecretNetworkClient exposed globally:', window.SecretNetworkClient);
                
                statusDiv.textContent = '‚úÖ SecretJS loaded successfully!';
                resultsDiv.innerHTML = `
                    <h3>Available SecretJS Components:</h3>
                    <ul>
                        <li>SecretNetworkClient: ${typeof window.SecretNetworkClient}</li>
                        <li>MsgSend: ${typeof window.MsgSend}</li>
                        <li>calculateFee: ${typeof window.calculateFee}</li>
                    </ul>
                    <p>SecretNetworkClient constructor: ${window.SecretNetworkClient ? 'Available' : 'Missing'}</p>
                `;
                
                // Dispatch event to notify wallet.js
                window.dispatchEvent(new CustomEvent('secretjs-loaded'));
                
            } catch (error) {
                console.error('‚ùå Skypack failed, trying jsDelivr...', error);
                statusDiv.textContent = 'Skypack failed, trying jsDelivr...';
                
                try {
                    const secretjs = await import('https://cdn.jsdelivr.net/npm/secretjs@1.15.1/+esm');
                    console.log('‚úÖ SecretJS imported successfully via jsDelivr');
                    
                    window.SecretNetworkClient = secretjs.SecretNetworkClient;
                    window.MsgSend = secretjs.MsgSend;
                    window.calculateFee = secretjs.calculateFee;
                    
                    console.log('‚úÖ SecretNetworkClient exposed globally:', window.SecretNetworkClient);
                    
                    statusDiv.textContent = '‚úÖ SecretJS loaded successfully from jsDelivr!';
                    resultsDiv.innerHTML = `
                        <h3>Available SecretJS Components:</h3>
                        <ul>
                            <li>SecretNetworkClient: ${typeof window.SecretNetworkClient}</li>
                            <li>MsgSend: ${typeof window.MsgSend}</li>
                            <li>calculateFee: ${typeof window.calculateFee}</li>
                        </ul>
                        <p>SecretNetworkClient constructor: ${window.SecretNetworkClient ? 'Available' : 'Missing'}</p>
                    `;
                    
                    window.dispatchEvent(new CustomEvent('secretjs-loaded'));
                    
                } catch (error2) {
                    console.error('‚ùå All SecretJS loading methods failed:', error2);
                    statusDiv.textContent = '‚ùå Failed to load SecretJS';
                    resultsDiv.innerHTML = `
                        <h3>Loading Failed</h3>
                        <p>Error: ${error2.message}</p>
                        <p>Both Skypack and jsDelivr failed to load SecretJS.</p>
                    `;
                }
            }
        })();
    </script>

    <!-- Test wallet.js style initialization -->
    <script>
        // Simulate wallet.js initialization
        const TestWallet = {
            init() {
                console.log('üîÆ Initializing test wallet interface...');
                
                if (typeof SecretNetworkClient === 'undefined') {
                    console.log('‚è≥ Waiting for SecretJS to load...');
                    
                    window.addEventListener('secretjs-loaded', () => {
                        console.log('‚úÖ SecretJS loaded event received, continuing initialization...');
                        this.initAfterSecretJS();
                    }, { once: true });
                    
                    setTimeout(() => {
                        if (typeof SecretNetworkClient === 'undefined') {
                            console.error('‚ùå SecretJS failed to load after 10 seconds');
                            document.getElementById('results').innerHTML += '<p style="color: red;">‚ùå Timeout: SecretJS failed to load</p>';
                        }
                    }, 10000);
                    
                    return;
                }
                
                console.log('‚úÖ SecretJS already available, continuing initialization...');
                this.initAfterSecretJS();
            },
            
            initAfterSecretJS() {
                console.log('‚úÖ SecretJS detected, wallet ready!');
                document.getElementById('results').innerHTML += '<p style="color: green;">‚úÖ Wallet initialization would succeed!</p>';
            }
        };
        
        // Start test when page loads
        document.addEventListener('DOMContentLoaded', () => {
            TestWallet.init();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecretJS UMD Test</title>
</head>
<body>
    <h1>SecretJS UMD Loading Test</h1>
    <div id="status">Loading...</div>
    <div id="results"></div>

    <!-- SecretJS Library (Official UMD Browser Bundle) -->
    <script>
        // Load SecretJS using official browser method with fallbacks
        (function loadSecretJS() {
            // CDN sources to try in order
            const cdnSources = [
                'https://unpkg.com/secretjs@1.15.1/dist/browser.js',
                'https://cdn.jsdelivr.net/npm/secretjs@1.15.1/dist/browser.js'
            ];
            
            function tryLoadFromCDN(index = 0) {
                if (index >= cdnSources.length) {
                    console.error('‚ùå All SecretJS CDN sources failed to load');
                    document.getElementById('status').textContent = '‚ùå All CDN sources failed';
                    return;
                }
                
                const scriptSrc = cdnSources[index];
                console.log(`üì¶ Loading SecretJS from: ${scriptSrc}`);
                document.getElementById('status').textContent = `Loading from: ${scriptSrc}`;
                
                const script = document.createElement('script');
                script.src = scriptSrc;
                
                script.onload = function() {
                    // Check if SecretJS loaded properly
                    if (typeof window.secretjs !== 'undefined' && window.secretjs.SecretNetworkClient) {
                        console.log('‚úÖ SecretJS loaded successfully from:', scriptSrc);
                        
                        // Expose components to global scope for compatibility
                        window.SecretNetworkClient = window.secretjs.SecretNetworkClient;
                        window.MsgSend = window.secretjs.MsgSend;
                        window.calculateFee = window.secretjs.calculateFee;
                        
                        console.log('‚úÖ SecretNetworkClient exposed globally:', window.SecretNetworkClient);
                        
                        document.getElementById('status').textContent = '‚úÖ SecretJS loaded successfully!';
                        document.getElementById('results').innerHTML = `
                            <h3>Success! SecretJS Components Available:</h3>
                            <ul>
                                <li>window.secretjs: ${typeof window.secretjs}</li>
                                <li>SecretNetworkClient: ${typeof window.SecretNetworkClient}</li>
                                <li>MsgSend: ${typeof window.MsgSend}</li>
                                <li>calculateFee: ${typeof window.calculateFee}</li>
                            </ul>
                            <p><strong>Loaded from:</strong> ${scriptSrc}</p>
                            <p><strong>Constructor available:</strong> ${window.SecretNetworkClient ? 'Yes' : 'No'}</p>
                        `;
                        
                        // Dispatch event to notify wallet.js
                        window.dispatchEvent(new CustomEvent('secretjs-loaded'));
                    } else {
                        console.warn('‚ö†Ô∏è SecretJS script loaded but secretjs global not found');
                        document.getElementById('status').textContent = `‚ö†Ô∏è Script loaded but global missing from: ${scriptSrc}`;
                        // Try next CDN
                        tryLoadFromCDN(index + 1);
                    }
                };
                
                script.onerror = function() {
                    console.warn(`‚ùå Failed to load SecretJS from: ${scriptSrc}`);
                    document.getElementById('status').textContent = `‚ùå Failed to load from: ${scriptSrc}`;
                    // Try next CDN
                    tryLoadFromCDN(index + 1);
                };
                
                document.head.appendChild(script);
            }
            
            // Start loading
            tryLoadFromCDN();
        })();
    </script>

    <!-- Test wallet.js style initialization -->
    <script>
        // Listen for SecretJS loaded event
        window.addEventListener('secretjs-loaded', () => {
            console.log('üéâ secretjs-loaded event received!');
            document.getElementById('results').innerHTML += '<p style="color: green;">üéâ Event-based initialization would work!</p>';
        });

        // Also test timeout approach
        setTimeout(() => {
            if (typeof SecretNetworkClient !== 'undefined') {
                console.log('‚úÖ Final test: SecretNetworkClient available via setTimeout');
                document.getElementById('results').innerHTML += '<p style="color: green;">‚úÖ Timeout-based initialization would also work!</p>';
            } else {
                console.log('‚ùå Final test: SecretNetworkClient still not available');
                document.getElementById('results').innerHTML += '<p style="color: red;">‚ùå Neither approach worked</p>';
            }
        }, 5000);
    </script>
</body>
</html>